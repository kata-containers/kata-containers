[package]
authors = { workspace = true }
edition = { workspace = true }
license = { workspace = true }
name    = "hypervisor"
version = "0.1.0"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
actix-rt          = { workspace = true }
anyhow            = { workspace = true }
async-trait       = { workspace = true }
crossbeam-channel = "0.5.6"
futures           = "0.3.25"
go-flag           = { workspace = true }
hyper             = { workspace = true, features = ["client"] }
hyperlocal        = { workspace = true }
lazy_static       = { workspace = true }
libc              = { workspace = true }
nix               = { workspace = true }
oci-spec          = { workspace = true }
path-clean        = "1.0.1"
protobuf          = { workspace = true }
qapi              = { version = "0.14", features = ["async-tokio-all", "qmp"] }
qapi-qmp          = "0.14.0"
qapi-spec         = "0.3.1"
rand              = { workspace = true }
rust-ini          = "0.18.0"
safe-path         = "0.1.0"
seccompiler       = "0.2.0"
serde             = { workspace = true }
serde_json        = { workspace = true }
slog              = { workspace = true }
slog-scope        = { workspace = true }
tempdir           = "0.3.7"
thiserror         = { workspace = true }
tokio             = { workspace = true, features = ["fs", "io-util", "process", "sync"] }
tracing           = { workspace = true }
ttrpc             = { workspace = true, features = ["async"] }
vmm-sys-util      = "0.11.0"

# Local dependencies
ch-config      = { workspace = true, optional = true }
kata-sys-util  = { workspace = true }
kata-types     = { workspace = true }
logging        = { workspace = true }
persist        = { workspace = true }
protocols      = { workspace = true, features = ["async"] }
shim-interface = { workspace = true }
tests_utils    = { workspace = true }

# Local dependencies: Dragonball
dbs-utils = { workspace = true }
dragonball = { workspace = true, features = [
  "atomic-guest-memory",
  "dbs-upcall",
  "host-device",
  "hotplug",
  "vhost-net",
  "vhost-user-net",
  "virtio-balloon",
  "virtio-blk",
  "virtio-fs",
  "virtio-mem",
  "virtio-net",
  "virtio-vsock",
], optional = true }

[features]
default = []

dragonball = ["dep:dragonball"]
# Feature is not yet complete, so not enabled by default.
# See https://github.com/kata-containers/kata-containers/issues/6264.
cloud-hypervisor = ["ch-config"]

[dev-dependencies]
serial_test = "2.0.0"

# Local dev-dependencies
# Force the CH tests to run, even when the feature is not enabled for
# a normal build.
hypervisor = { workspace = true, features = ["cloud-hypervisor"] }
test-utils = { workspace = true }

[build-dependencies]
ttrpc-codegen = "0.4.2"

[lints.rust]
unexpected_cfgs = { level = "warn", check-cfg = [
  'cfg(feature, values("enable-vendor"))',
] }
