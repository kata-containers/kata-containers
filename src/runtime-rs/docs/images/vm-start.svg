<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1038px" preserveAspectRatio="none" style="width:1628px;height:1038px;background:#FFFFFF;" version="1.1" viewBox="0 0 1628 1038" width="1628px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="267" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="447" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="617" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="728" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="948" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1208" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1356" y="46.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="272" x2="272" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="451.5" x2="451.5" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="622" x2="622" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="733" x2="733" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="953" x2="953" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1212.5" x2="1212.5" y1="36.2969" y2="1003.2813"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1361" x2="1361" y1="36.2969" y2="1003.2813"/><rect fill="#FFA500" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="227" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="234" y="24.9951">hypervisor</text><rect fill="#FFA500" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="227" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="234" y="1022.2764">hypervisor</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="395.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="402.5" y="24.9951">sandbox start</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="395.5" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="402.5" y="1022.2764">sandbox start</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="594" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="601" y="24.9951">agent</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="594" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="601" y="1022.2764">agent</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="146" x="660" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="667" y="24.9951">resource_manager</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="146" x="660" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="667" y="1022.2764">resource_manager</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="858" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="865" y="24.9951">resource_manager_inner</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="858" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="865" y="1022.2764">resource_manager_inner</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1176.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1183.5" y="24.9951">share_fs</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1176.5" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1183.5" y="1022.2764">share_fs</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1324" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1331" y="24.9951">network</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1324" y="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1331" y="1022.2764">network</text><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="267" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="447" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="617" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="728" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="948" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1208" y="46.2969"/><rect fill="#FFFFFF" height="947.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1356" y="46.2969"/><polygon fill="#181818" points="288,63.4297,278,67.4297,288,71.4297,284,67.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="446" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="294" y="62.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="307" y="62.3638">prepare_vm()</text><path d="M5,80.4297 L5,105.4297 L540,105.4297 L540,90.4297 L530,80.4297 L5,80.4297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M530,80.4297 L530,90.4297 L540,90.4297 L530,80.4297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="514" x="11" y="97.4966">fill the hypervisor struct,set the vmm state, or anything needed before start vm</text><polygon fill="#181818" points="716,127.6953,726,131.6953,716,135.6953,720,131.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="722" y1="131.6953" y2="131.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="464" y="126.6294">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="477" y="126.6294">prepare_before_start_vm()</text><polygon fill="#181818" points="936,156.8281,946,160.8281,936,164.8281,940,160.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="942" y1="160.8281" y2="160.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="745" y="155.7622">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="757" y="155.7622">prepare_before_start_vm()</text><polygon fill="#181818" points="1196,185.9609,1206,189.9609,1196,193.9609,1200,189.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1202" y1="189.9609" y2="189.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="965" y="184.895">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="978" y="184.895">setup_device_before_start_vm ()</text><line style="stroke:#181818;stroke-width:1.0;" x1="1218" x2="1260" y1="219.0938" y2="219.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="1260" x2="1260" y1="219.0938" y2="232.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="1219" x2="1260" y1="232.0938" y2="232.0938"/><polygon fill="#181818" points="1229,228.0938,1219,232.0938,1229,236.0938,1225,232.0938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1225" y="214.0278">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="1238" y="214.0278">prepare_virtiofs()</text><path d="M1125,245.0938 L1125,270.0938 L1301,270.0938 L1301,255.0938 L1291,245.0938 L1125,245.0938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1291,245.0938 L1291,255.0938 L1301,255.0938 L1291,245.0938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="1131" y="262.1606">prepare share_fs device</text><polygon fill="#181818" points="288,292.3594,278,296.3594,288,300.3594,284,296.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="1207" y1="296.3594" y2="296.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="294" y="291.2935">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="307" y="291.2935">add_device()</text><path d="M1078,309.3594 L1078,334.3594 L1347,334.3594 L1347,319.3594 L1337,309.3594 L1078,309.3594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1337,309.3594 L1337,319.3594 L1347,319.3594 L1337,309.3594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="1084" y="326.4263">add share_fs device to the pending list</text><polygon fill="#181818" points="1344,356.625,1354,360.625,1344,364.625,1348,360.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1350" y1="360.625" y2="360.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="965" y="355.5591">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="978" y="355.5591">new()</text><path d="M1101,373.625 L1101,398.625 L1621,398.625 L1621,383.625 L1611,373.625 L1101,373.625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1611,373.625 L1611,383.625 L1621,383.625 L1611,373.625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="499" x="1107" y="390.6919">scan the network namespace to get the endpoint and create the network pair</text><polygon fill="#181818" points="1344,420.8906,1354,424.8906,1344,428.8906,1348,424.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1350" y1="424.8906" y2="424.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="965" y="419.8247">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="978" y="419.8247">setup()</text><path d="M1199,437.8906 L1199,462.8906 L1522,462.8906 L1522,447.8906 L1512,437.8906 L1199,437.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1512,437.8906 L1512,447.8906 L1522,447.8906 L1512,437.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="1205" y="454.9575">setup the network model for each network pair</text><polygon fill="#181818" points="288,485.1563,278,489.1563,288,493.1563,284,489.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="1355" y1="489.1563" y2="489.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="294" y="484.0903">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="307" y="484.0903">add_device()</text><path d="M1214,502.1563 L1214,527.1563 L1507,527.1563 L1507,512.1563 L1497,502.1563 L1214,502.1563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1497,502.1563 L1497,512.1563 L1507,512.1563 L1497,502.1563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="1220" y="519.2231">add tap/Macvtap device to the pending list</text><polygon fill="#181818" points="288,549.4219,278,553.4219,288,557.4219,284,553.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="446" y1="553.4219" y2="553.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="294" y="548.356">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="317" y="548.356">start_vm()</text><path d="M194,566.4219 L194,591.4219 L350,591.4219 L350,576.4219 L340,566.4219 L194,566.4219 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M340,566.4219 L340,576.4219 L350,576.4219 L340,566.4219 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="200" y="583.4888">hypervisor start here</text><polygon fill="#181818" points="288,613.6875,278,617.6875,288,621.6875,284,617.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="446" y1="617.6875" y2="617.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="294" y="612.6216">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="316" y="612.6216">get_agent_socket()</text><polygon fill="#181818" points="605,642.8203,615,646.8203,605,650.8203,609,646.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="611" y1="646.8203" y2="646.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="464" y="641.7544">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="486" y="641.7544">start()</text><polygon fill="#181818" points="716,671.9531,726,675.9531,716,679.9531,720,675.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="722" y1="675.9531" y2="675.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="464" y="670.8872">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="485" y="670.8872">setup_after_start_vm()</text><polygon fill="#181818" points="936,701.0859,946,705.0859,936,709.0859,940,705.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="942" y1="705.0859" y2="705.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="745" y="700.02">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="767" y="700.02">setup_after_start_vm()</text><polygon fill="#181818" points="1196,730.2188,1206,734.2188,1196,738.2188,1200,734.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1202" y1="734.2188" y2="734.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="965" y="729.1528">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="987" y="729.1528">setup_device_after_start_vm()</text><path d="M1160,747.2188 L1160,772.2188 L1265,772.2188 L1265,757.2188 L1255,747.2188 L1160,747.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1255,747.2188 L1255,757.2188 L1265,757.2188 L1255,747.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1166" y="764.2856">setup virtiofs</text><polygon fill="#181818" points="288,794.4844,278,798.4844,288,802.4844,284,798.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="1207" y1="798.4844" y2="798.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="294" y="793.4185">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="316" y="793.4185">add_device()</text><path d="M1085,811.4844 L1085,836.4844 L1341,836.4844 L1341,821.4844 L1331,811.4844 L1085,811.4844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1331,811.4844 L1331,821.4844 L1341,821.4844 L1331,811.4844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="1091" y="828.5513">Share the source path into the guest</text><polygon fill="#181818" points="1344,858.75,1354,862.75,1344,866.75,1348,862.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1350" y1="862.75" y2="862.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="965" y="857.6841">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="987" y="857.6841">handle_interfaces()</text><polygon fill="#181818" points="1344,887.8828,1354,891.8828,1344,895.8828,1348,891.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1350" y1="891.8828" y2="891.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="965" y="886.8169">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="987" y="886.8169">handle_neighbours()</text><polygon fill="#181818" points="1344,917.0156,1354,921.0156,1344,925.0156,1348,921.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="958" x2="1350" y1="921.0156" y2="921.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="965" y="915.9497">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="987" y="915.9497">handle_routes()</text><path d="M1168,934.0156 L1168,959.0156 L1554,959.0156 L1554,944.0156 L1544,934.0156 L1168,934.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1544,934.0156 L1544,944.0156 L1554,944.0156 L1544,934.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="1174" y="951.0825">Update the network like neighbours, interface and routes</text><polygon fill="#181818" points="605,981.2813,615,985.2813,605,989.2813,609,985.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="611" y1="985.2813" y2="985.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="464" y="980.2153">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="487" y="980.2153">create_sandbox()</text><!--MD5=[c7d270c214bcb879c70846b52bf56c0c]
@startuml
autonumber
participant "hypervisor" as h #orange
participant "sandbox start" as s
participant "agent" as a
participant "resource_manager" as rs
participant "resource_manager_inner" as rsi
participant "share_fs" as sfs
participant "network" as n

activate s
activate h
activate rs
activate rsi
activate sfs
activate n
activate a
s -> h: prepare_vm()
note over h: fill the hypervisor struct,set the vmm state, or anything needed before start vm
s -> rs: prepare_before_start_vm()
rs-> rsi: prepare_before_start_vm()
rsi->sfs: setup_device_before_start_vm ()
sfs->sfs: prepare_virtiofs()
note over sfs: prepare share_fs device
sfs->h: add_device()
note over sfs: add share_fs device to the pending list
rsi->n: new()
note over n: scan the network namespace to get the endpoint and create the network pair
rsi->n: setup()
note over n: setup the network model for each network pair
n->h: add_device()
note over n: add tap/Macvtap device to the pending list
s->h: start_vm()
note over h: hypervisor start here
s->h: get_agent_socket()
s->a: start()
s->rs: setup_after_start_vm()
rs->rsi: setup_after_start_vm()
rsi->sfs: setup_device_after_start_vm()
note over sfs: setup virtiofs
sfs->h: add_device()
note over sfs
Share the source path into the guest
end note
rsi->n: handle_interfaces()
rsi->n: handle_neighbours()
rsi->n: handle_routes()
note over n: Update the network like neighbours, interface and routes
s->a: create_sandbox()
@enduml

PlantUML version 1.2022.8beta9(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>