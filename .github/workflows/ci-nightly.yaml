name: Kata Containers Nightly CI
on:
  schedule:
    - cron: '0 0 * * *'

env:
  COMMIT_HASH: ${GITHUB_REF}

jobs:
  set-fake-pr-number:
    runs-on: ubuntu-latest
    steps:
      - name: Set fake PR number
        run: |
          echo "PR_NUMBER=$(date +%Y%m%d%H%M%S)" >> "$GITHUB_ENV"

  kata-containers-ci-on-push:
    needs: set-fake-pr-number
    uses: ./.github/workflows/ci.yaml
    with:
      commit-hash: $COMMIT_HASH
      pr-number: $PR_NUMBER
      tag: $PR_NUMBER-$COMMIT_HASH-nightly
