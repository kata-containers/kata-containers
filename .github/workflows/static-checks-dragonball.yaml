on:
  workflow_call:

name: Static checks dragonball
jobs:
  test-dragonball:
    runs-on: self-hosted
    env:
      RUST_BACKTRACE: "1"
    steps:
      - uses: actions/checkout@v3
      - name: Set env
        run: |
          echo "GOPATH=${{ github.workspace }}" >> $GITHUB_ENV
      - name: Install Rust
        run: |
          ./ci/install_rust.sh
          PATH=$PATH:"$HOME/.cargo/bin"
      - name: Run Unit Test
        run: |
          cd src/dragonball
          cargo version
          rustc --version
          sudo -E env PATH=$PATH LIBC=gnu SUPPORT_VIRTUALIZATION=true make test
