name: snap CI
on:
  workflow_call:

jobs:
  test:
    runs-on: ubuntu-20.04
    steps:
      - name: Check out
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install Snapcraft
        run: |
          # Required to avoid snapcraft install failure
          sudo chown root:root /

          # "--classic" is needed for the GitHub action runner
          # environment.
          sudo snap install snapcraft --classic

          # Allow other parts to access snap binaries
          echo /snap/bin >> "$GITHUB_PATH"

      - name: Build snap
        run: |
          snapcraft snap --debug --destructive-mode
